<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Detail Barang</title>
  <script src="https://cdn.tailwindcss.com"></script>
</head>

<body class="font-sans bg-gray-50">
  <!-- Hero Wrapper -->
  <section class="relative h-[60vh] bg-cover bg-center bg-no-repeat"
    style="background-image: url('img/hero/hero-1.jpg');">
    <div class="absolute inset-0 bg-white/80 z-0"></div>

    <!-- Navbar -->
    <nav class="absolute top-0 left-0 w-full flex justify-between items-center px-6 py-4 z-10">
      <a href="index.html" class="flex items-center gap-2">
        <img src="img/Logo.png" alt="Logo MahaSewa" class="h-6 w-6 object-contain" />
        <div class="text-2xl font-bold text-[#0075be]">MahaSewa</div>
      </a>
      <div class="flex gap-3">
        <button class="bg-black text-white px-4 py-2 rounded-full text-sm hover:bg-gray-800 transition">Login</button>
        <button
          class="bg-black text-white px-4 py-2 rounded-full text-sm hover:bg-gray-800 transition">Register</button>
      </div>
    </nav>

    <!-- Hero Content -->
    <div class="absolute inset-0 flex flex-col items-center justify-center text-center px-6 md:px-20 z-9">
      <div class="mb-8 max-w-3xl space-y-5">
        <h1 class="text-4xl md:text-5xl font-bold text-gray-900 leading-tight">
          Sewa & sewakan barang <span class="block">jadi lebih mudah!</span>
        </h1>
      </div>
      <div
        class="mt-8 w-full max-w-3xl bg-white rounded-2xl shadow-lg p-4 flex flex-col md:flex-row gap-3 items-center md:items-stretch">
        <select id="select-kota" name="kota"
          class="bg-gray-100 text-sm rounded-md px-4 py-2 w-full md:w-auto focus:outline-none">
          <option value="">Pilih Kota</option>
          <option value="Yogyakarta">Yogyakarta</option>
          <option value="Bandung">Bandung</option>
          <option value="Jakarta">Jakarta</option>
        </select>

        <select id="select-kategori" name="kategori"
          class="bg-gray-100 text-sm rounded-md px-4 py-2 w-full md:w-auto focus:outline-none">
          <option value="">Kategori</option>
          <option value="Furnitur">Furnitur</option>
          <option value="Peralatan Dapur">Peralatan Dapur</option>
          <option value="Outdoor">Outdoor</option>
          <option value="Elektronik">Elektronik</option>
          <option value="Alat Musik">Alat Musik</option>
          <option value="Fashion">Fashion</option>
        </select>

        <input id="input-search" name="nama" type="text" placeholder="Cari barang..."
          class="bg-gray-100 text-sm rounded-md px-4 py-2 flex-grow focus:outline-none w-full" />

        <button id="btn-search" class="bg-blue-600 hover:bg-blue-700 transition text-white px-4 py-2 rounded-md">
          Cari
        </button>
      </div>
    </div>
  </section>

  <div class="max-w-6xl mx-auto p-6 grid md:grid-cols-2 gap-10">
    <!-- Gambar Produk -->
    <div>
      <img id="gambar-produk" src="" alt="Produk" class="rounded-xl w-full object-cover shadow-lg" />
    </div>

    <!-- Detail Produk -->
    <div class="space-y-6">
      <h1 id="nama-produk" class="text-3xl font-bold text-gray-800"></h1>
      <div class="flex gap-6 text-gray-700 text-sm font-medium mt-1">
        <div class="flex items-center gap-2 bg-blue-50 text-blue-700 px-3 py-2 rounded-xl shadow-sm">
          <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 flex-shrink-0" fill="none" viewBox="0 0 24 24"
            stroke="currentColor" stroke-width="2">
            <path stroke-linecap="round" stroke-linejoin="round"
              d="M5.121 17.804A11.955 11.955 0 0112 15c2.21 0 4.287.59 6.037 1.616M12 7a4 4 0 110 8 4 4 0 010-8z" />
          </svg>
          <span><strong>Pemilik:</strong> <span id="info-pemilik"></span></span>
        </div>

        <div class="flex items-center gap-2 bg-green-50 text-green-700 px-3 py-2 rounded-xl shadow-sm">
          <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 flex-shrink-0" fill="none" viewBox="0 0 24 24"
            stroke="currentColor" stroke-width="2">
            <path stroke-linecap="round" stroke-linejoin="round"
              d="M17.657 16.657L13.414 12.414a4 4 0 10-5.656 5.656l4.243 4.243a4 4 0 005.656-5.656z" />
            <path stroke-linecap="round" stroke-linejoin="round" d="M15 11a3 3 0 11-6 0 3 3 0 016 0z" />
          </svg>
          <span><strong>Kota:</strong> <span id="info-kota"></span></span>
        </div>

        <div class="flex items-center gap-2 bg-yellow-50 text-yellow-700 px-3 py-2 rounded-xl shadow-sm">
          <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 flex-shrink-0" fill="currentColor" viewBox="0 0 20 20">
            <path
              d="M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.286 3.957a1 1 0 00.95.69h4.165c.969 0 1.371 1.24.588 1.81l-3.374 2.455a1 1 0 00-.364 1.118l1.287 3.957c.3.92-.755 1.688-1.54 1.118l-3.374-2.455a1 1 0 00-1.176 0l-3.374 2.455c-.785.57-1.838-.197-1.539-1.118l1.286-3.957a1 1 0 00-.364-1.118L2.03 9.384c-.783-.57-.38-1.81.588-1.81h4.165a1 1 0 00.95-.69l1.286-3.957z" />
          </svg>
          <span><strong>Rating:</strong> <span id="info-rating"></span> / 5</span>
        </div>
      </div>

      <!-- Kalender & Request -->
      <div class="bg-white p-6 rounded-2xl shadow-xl">
        <h2 class="text-gray-700 font-semibold mb-4">Pilih Tanggal Sewa</h2>
        <div class="grid grid-cols-2 gap-4 mb-4">
          <div>
            <label class="block text-sm text-gray-500 mb-1">Mulai</label>
            <input type="date" id="tanggal-mulai" class="w-full border border-gray-300 rounded-lg px-3 py-2 text-sm" />
          </div>
          <div>
            <label class="block text-sm text-gray-500 mb-1">Selesai</label>
            <input type="date" id="tanggal-selesai"
              class="w-full border border-gray-300 rounded-lg px-3 py-2 text-sm" />
          </div>
        </div>

        <p id="rent-summary" class="text-center text-gray-600 text-sm mb-3">Pilih tanggal untuk melihat total</p>
        <p id="total-harga" class="text-center text-2xl font-bold text-black mb-6">Rp 0</p>

        <button id="btn-request"
          class="w-full bg-blue-600 text-white py-3 rounded-lg text-sm font-semibold hover:bg-indigo-700 transition">
          Kirim Permintaan Sewa
        </button>

        <!-- Map Container -->
        <div id="map-container" class="mt-6 rounded-xl overflow-hidden shadow-lg" style="height: 300px;">
          <iframe id="map-frame" src="" width="100%" height="100%" style="border:0;" allowfullscreen="" loading="lazy"
            referrerpolicy="no-referrer-when-downgrade"></iframe>
        </div>
      </div>
    </div>
  </div>

  <script src="data-barang.js"></script>
  <script>
    const params = new URLSearchParams(window.location.search);
    const id = params.get("id");
    const item = barang.find(i => i.id == id);

    if (item) {
      document.getElementById("gambar-produk").src = item.gambar;
      document.getElementById("nama-produk").textContent = item.nama;
      document.getElementById("info-pemilik").textContent = item.pemilik || "Tidak diketahui";
      document.getElementById("info-kota").textContent = item.kota || "Tidak diketahui";
      document.getElementById("info-rating").textContent = item.rating !== undefined ? item.rating.toFixed(1) : "0";

      // Set minimum tanggal mulai dan selesai ke hari ini (otomatis), pakai format lokal
      const today = new Date();
      const year = today.getFullYear();
      const month = String(today.getMonth() + 1).padStart(2, "0");
      const day = String(today.getDate()).padStart(2, "0");
      const todayString = `${year}-${month}-${day}`;

      const tanggalMulaiInput = document.getElementById("tanggal-mulai");
      const tanggalSelesaiInput = document.getElementById("tanggal-selesai");

      tanggalMulaiInput.min = todayString;
      tanggalSelesaiInput.min = todayString;

      function updateHarga() {
        const mulaiVal = tanggalMulaiInput.value;
        const selesaiVal = tanggalSelesaiInput.value;

        if (mulaiVal) {
          const mulaiDate = new Date(mulaiVal);
          mulaiDate.setDate(mulaiDate.getDate() + 1);
          // Ganti toISOString() dengan cara format lokal supaya sesuai zona waktu lokal
          const y = mulaiDate.getFullYear();
          const m = String(mulaiDate.getMonth() + 1).padStart(2, "0");
          const d = String(mulaiDate.getDate()).padStart(2, "0");
          tanggalSelesaiInput.min = `${y}-${m}-${d}`;
        } else {
          tanggalSelesaiInput.min = todayString;
        }

        if (!mulaiVal || !selesaiVal) {
          document.getElementById("rent-summary").textContent = "Pilih tanggal untuk melihat total";
          document.getElementById("total-harga").textContent = "Rp 0";
          return;
        }

        const mulai = new Date(mulaiVal);
        const selesai = new Date(selesaiVal);

        if (selesai <= mulai) {
          document.getElementById("rent-summary").textContent = "Tanggal selesai harus setelah tanggal mulai";
          document.getElementById("total-harga").textContent = "Rp 0";
          return;
        }

        const hari = Math.ceil((selesai - mulai) / (1000 * 60 * 60 * 24));
        const total = hari * item.harga;

        document.getElementById("rent-summary").textContent = `Untuk ${hari} hari`;
        document.getElementById("total-harga").textContent = `Rp ${total.toLocaleString()}`;
      }

      tanggalMulaiInput.addEventListener("change", updateHarga);
      tanggalSelesaiInput.addEventListener("change", updateHarga);

      document.getElementById("btn-request").addEventListener("click", () => {
        const mulai = tanggalMulaiInput.value;
        const selesai = tanggalSelesaiInput.value;
        if (!mulai || !selesai) {
          alert("Silakan pilih tanggal mulai dan selesai.");
          return;
        }
        if (mulai < todayString) {
          alert("Tanggal mulai tidak boleh sebelum hari ini.");
          tanggalMulaiInput.value = todayString;
          return;
        }
        if (selesai <= mulai) {
          alert("Tanggal selesai harus setelah tanggal mulai.");
          return;
        }
        alert(`Request sewa dikirim untuk ${item.nama} dari ${mulai} sampai ${selesai}`);
      });

      // Validasi tambahan untuk cegah input tanggal mulai sebelum hari ini manual
      tanggalMulaiInput.addEventListener("change", () => {
        const val = tanggalMulaiInput.value;
        if (val < todayString) {
          alert("Tanggal mulai tidak boleh sebelum hari ini.");
          tanggalMulaiInput.value = todayString;
        }
        // Update minimum tanggal selesai agar selalu > tanggal mulai
        if (tanggalMulaiInput.value) {
          const mulaiDate = new Date(tanggalMulaiInput.value);
          mulaiDate.setDate(mulaiDate.getDate() + 1);
          const y = mulaiDate.getFullYear();
          const m = String(mulaiDate.getMonth() + 1).padStart(2, "0");
          const d = String(mulaiDate.getDate()).padStart(2, "0");
          tanggalSelesaiInput.min = `${y}-${m}-${d}`;
        } else {
          tanggalSelesaiInput.min = todayString;
        }
        updateHarga();
      });

      // Validasi tanggal selesai agar selalu > tanggal mulai
      tanggalSelesaiInput.addEventListener("change", () => {
        if (tanggalSelesaiInput.value && tanggalMulaiInput.value) {
          if (tanggalSelesaiInput.value <= tanggalMulaiInput.value) {
            alert("Tanggal selesai harus setelah tanggal mulai.");
            tanggalSelesaiInput.value = "";
          }
        }
        updateHarga();
      });

      // Set lokasi peta
      const mapFrame = document.getElementById("map-frame");
      mapFrame.src = `https://maps.google.com/maps?q=${encodeURIComponent(item.kota)}&t=&z=13&ie=UTF8&iwloc=&output=embed`;
    } else {
      alert("Barang tidak ditemukan.");
    }
  </script>

</body>

</html>